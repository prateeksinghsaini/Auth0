<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auth0 Debug</title>
    <script src="https://cdn.auth0.com/js/auth0-spa-js/2.0.0/auth0-spa-js.production.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }

        button {
            background: #0070f3;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background: #0051a2;
        }

        .error {
            color: #e00;
        }

        .success {
            color: #0a0;
        }
    </style>
</head>

<body>
    <h1>Auth0 Debug Page</h1>
    <p>This page is for debugging Auth0 integration issues.</p>

    <div>
        <h2>Configuration</h2>
        <pre id="config"></pre>
        <button id="loginBtn">Test Login</button>
    </div>

    <div>
        <h2>Result</h2>
        <pre id="result">Click "Test Login" to see result</pre>
    </div>

    <script>
        // Configuration
        const domain = 'dev-fdzhuhkeczctb04h.us.auth0.com';
        const clientId = '4feQ9Lwi3d7aW3sWDhfQ2vgRYMGcPE7u';
        const redirectUri = window.location.origin + '/auth0-debug.html';

        // Display configuration
        document.getElementById('config').textContent = JSON.stringify({
            domain,
            clientId,
            redirectUri
        }, null, 2);

        // Handle login
        document.getElementById('loginBtn').addEventListener('click', async () => {
            try {
                const resultElem = document.getElementById('result');
                resultElem.textContent = 'Initializing Auth0...';

                const auth0 = await createAuth0Client({
                    domain,
                    clientId,
                    authorizationParams: {
                        redirect_uri: redirectUri
                    }
                });

                resultElem.textContent = 'Auth0 initialized, attempting login...';

                await auth0.loginWithRedirect();

                // Note: This won't execute until after redirect back
                resultElem.textContent = 'Login successful!';
                resultElem.className = 'success';
            } catch (error) {
                const resultElem = document.getElementById('result');
                resultElem.textContent = 'Error: ' + error.message + '\n\n' + JSON.stringify(error, null, 2);
                resultElem.className = 'error';
                console.error('Auth0 error:', error);
            }
        });

        // Handle redirect callback
        (async () => {
            if (window.location.search.includes('code=')) {
                try {
                    const resultElem = document.getElementById('result');
                    resultElem.textContent = 'Processing login callback...';

                    const auth0 = await createAuth0Client({
                        domain,
                        clientId,
                        authorizationParams: {
                            redirect_uri: redirectUri
                        }
                    });

                    await auth0.handleRedirectCallback();
                    const user = await auth0.getUser();

                    resultElem.textContent = 'Login successful!\n\nUser: ' + JSON.stringify(user, null, 2);
                    resultElem.className = 'success';
                } catch (error) {
                    const resultElem = document.getElementById('result');
                    resultElem.textContent = 'Callback error: ' + error.message + '\n\n' + JSON.stringify(error, null, 2);
                    resultElem.className = 'error';
                    console.error('Auth0 callback error:', error);
                }
            }
        })();
    </script>
</body>

</html>